---
title: "Taller_2"
author: "John Esteban"
date: "2024-03-25"
output:
  pdf_document: default
  html_document: default
  word_document: default
---

```{r}
set.seed(1234)
library("rvest")
library(httr)
library(tidyverse)
library(devtools)
library(tidyverse)
library(gridExtra)
library(knitr)
library(kableExtra)
```

```{r}
source_url("https://raw.githubusercontent.com/Esteban7777/Curso-Big-Data/main/Taller%202/1.Procesamiento%20y%20sintaxis/Script%20para%20cargar%20la%20data%20desde%20el%20repositorio.R")

source_url("https://raw.githubusercontent.com/Esteban7777/Curso-Big-Data/main/Taller%202/1.Procesamiento%20y%20sintaxis/funMergePersonasHogares.R")
```

# Introduccion

La pobreza es uno de los temas centrales de investigación en la economía del bienestar y en las agendas políticas de todos los gobiernos, especialmente en los países en vías de desarrollo. Sin embargo, no hay un consenso en su definición y en su forma de ser medida. A pesar de esto, se puede entender que ser pobre es no disponer de los recursos para obtener los medios mínimos de subsistencia, una definición general. El Banco Mundial define la pobreza como incapacidades para llevar una vida plena, desagregándolo en buena alimentación, calidad de la vivienda, buena salud, buena educación y tener un trabajo digno. También tenemos la definición de uno de los economistas que más influencia tiene en el estudio de la pobreza, Amartya Sen. Con la teoría de las capacidades, este autor dice que la pobreza no es simplemente la falta de ingreso, sino la falta de capacidades básicas y la libertad para obtenerlo, definición muy parecida a la propuesta del Banco Mundial. En resumen, los avances del estudio teórico de la pobreza han reposado en que es un fenómeno multidimensional y no solamente carencia de ingresos.

De la misma forma que las definiciones, la forma de medir la pobreza es variada, donde se tiene en cuenta la multidimensionalidad de la pobreza que tanto se menciona en la etapa de definición. En primer lugar, se tiene el NBI (Necesidades Básicas Insatisfechas) que señala la insuficiencia que tiene un hogar en una de las siguientes necesidades básicas: Vivienda con Materiales adecuados, servicios públicos de acueducto y alcantarillado, nivel bajo de hacinamiento, bajo grado de dependencia. También se encuentra el método de la línea de pobreza, que calcula el costo de una canasta básica de bienes y servicios, luego calcula los ingresos del hogar y se compara con esta línea, si no alcanza este mínimo entonces se considera un hogar pobre. Por último, también se trabaja con el Índice de Condiciones de vida, que comprende variables que miden la calidad de la vivienda, el capital humano actual y potencial, el acceso a la calidad de los servicios y las condiciones del hogar. En este trabajo se va a trabajar con el indicador de línea de pobreza.

El objetivo de este artículo es encontrar los determinantes económicos y sociales que más inciden en clasificar a una persona como pobre o no pobre a través de la medida de línea de pobreza. Para esto se utilizan los datos del DANE que vienen de la Misión de Empalme de las Series de Empleo, Pobreza y Desigualdad. En esta base de datos se encuentra a nivel de hogar y de personas y recoge toda la información sobre las condiciones de empleo de las personas, además de todas las características socioeconómicas generales y que son importantes para determinar la pobreza de un hogar. Por tanto, con estas variables se puede estimar en términos de probabilidades las características de la población menos favorecida.

El estudio de los determinantes de la pobreza es importante porque muestra los temas en los que es necesario focalizar las políticas públicas. En Colombia se han realizado varios estudios que buscan encontrar los determinantes de la pobreza con datos de tipo transversal. Nunes & Ramírez (2002) utilizan un modelo de respuesta cualitativa para encontrar las características socioeconómicas de los hogares más pobres a través de la estimación de probabilidades. Estos autores encuentran que el nivel educativo, la cantidad de los miembros del hogar, la tasa de ocupación y la ubicación del hogar son variables que afectan la probabilidad de ser o no hogares pobres.

En la misma dirección, Chaves (2010) encuentra con un modelo logit que la educación del jefe de hogar, la posesión de activos, el tamaño del hogar, el tipo de vivienda y el género del jefe de hogar son determinantes de que este se encuentre o no en situación de pobreza. De esta forma, la mayoría de los estudios de los determinantes de la pobreza tienen una forma similar de trabajar, se establecen las variables de control, se crea la variable de respuesta binaria a través de la línea de pobreza y se procede con la estimación de los parámetros con modelos probit o logit (Nunes & Ramírez, 2002), (Nunes, Ramírez, Cuesta, 2005), (Chaves, 2010), (Marrugo et al., 2015).

Un factor común que utilizan todos los estudios es trabajar y estimar la pobreza de un hogar a través de las condiciones del jefe de hogar, esto debido a que es el responsable sobre todo económico de todos los integrantes. Por esta razón, es importante estudiar la posición del jefe de hogar en el mercado laboral, ya que muestra la capacidad de los ingresos y calidad de vida. Investigar sobre su posición en el mercado y si trabaja en condiciones de informalidad puede ser un determinante de la condición de pobreza. Esto debido a que trabajar en condiciones de informalidad, por sus características precarias y bajos salarios, puede explicar la pobreza en un hogar (Torres et al., 2022). También la edad del jefe de hogar puede servir como determinante de la pobreza porque, desde la teoría, se considera que hay edades donde es tiene más incidencia el desempleo como en la población joven y más adulta (Klose, 2012).

# Datos

## Seleccion de los datos

La seleccion de las variables se hacen tomando como referencia los estudios analizados para este proceso y todo se trabaja a nivel de hogar como lo recomienda Chaves(2010), (Torres, et al,2022), (Klose,2012)

-   p6050: Si es jefe de hogar
-   p620: Sexo del jefe de hogar
-   p6100: Tipo de regimen
-   p6210: Educacion
-   p6240: Empleado
-   p6430: Posicion laboral del jefe de hogar
-   Personas por habitacion
-   Tipo de vivienda: propia o no
-   Edad del jefe de hogar
-   Zona: Rural o Urbana
-   Tipo de trabajo

## Limpieza de los datos.

Todo el analisis exploratorio de datos y la modelación se hace para las personas que han reportado que son jefes de hogar, por esto la limpieza mas importante es crear la variable jefe, que establece que si es jefe de hogar tiene el valor de 1 y 0 en los otros caso, por esto al momento de traer las variables del nivel de personas al de hogar se hace tomando como referencia si es jefe de hogar,

```{r}
train_personas$jefe<-ifelse(test = train_personas$P6050==1,1,0)
test_personas$jefe<-ifelse(test = test_personas$P6050==1,1,0)
```

Para automatizar el proceso de traer las caracteristicas que pueden explicar la pobreza monetaria de un hogar se crea la función crear\_, que tiene el siguiente funcionamiento. Primero se guarda la función segun seal nombre de la variable a traer, esta funcion recibe como parametro la base de datos sobre la cual se va a construir la variable, el primer filtro que se aplica es que en la base de datos de personas debe estar filtrada solo para los jefes de hogar, del dataframe se toma la variable de interes junto con el identificador unico de personas que crea la base de datos y por ultimo se crea el join con la base de datos de hogares por medio de este identificador. La función llamada traer variable garantiza que no se repitan los id y que tenenmos registros unicos en toda la muestra.

```{r}
crear_sexo_jefe<-function(df){
  aux<-df %>% filter(jefe==1)
  aux2<-data.frame(sexo_jefe=aux$P6020,id=aux$id)
  df<-left_join(df,aux2,by="id")
  return(df)
}
train_personas<-crear_sexo_jefe(train_personas)
train_hogares<-traer_variable(train_hogares,train_personas,"sexo_jefe")
train_hogares$sexo_jefe<-as.factor(train_hogares$sexo_jefe)

test_personas<-crear_sexo_jefe(test_personas)
test_hogares<-traer_variable(test_hogares,test_personas,"sexo_jefe")
test_hogares$sexo_jefe<-as.factor(test_hogares$sexo_jefe)
```

Este proceso se hace para cada una de las variables , en este dosumento solo se presenta el caso para el sexo del jefe del hogar, en el script Creación de variables de interes esta el proceso para cada una de las variables.

Este proceso se hace para las siguientes variables:

```{r,echo=FALSE}
variables <- data.frame(
  Variable = c('Sexo_jefe',
               'Regimen_subsidiado',
               'Educacion_jefe',
               'Ocupacion_jefe',
               'Posicion_Jefe',
               'Personas_habitacion',
               'Edad del jefe del hogar',
               'Informalidad_jefe'
  ),
  Transformacion = c('Se trabaja como una variable dummy 1 cuando es hombre y cero cuando es mujer',
                     
                     '1 cuando el jefe de hogar esta afiliado en el regimen subsidiado, 0 en otro caso',
                     
                     'Ultimo grado aprobado por el jefe de hogar',
                     
                     'Si el jefe de hogar manifiesta que la semana anterior trabajo, 0 y 1 para cualquier otra respuesta',
                     
                     'Se trabajan todas las categorias de la variable sin ninguna transformacion',
                     
                     'Se divide el total de personas por la cantidad de habitaciones que reporto el jefe de hogar',
                     
                     'Se toma la definición de informalidad del DANE si el establecimiento tiene menos de 10 trabajadores se considera como informal',
                     
                     'Se trabaja tal cual se reporta en la encuesta'
  ),
  Hipotesis = c('Las mujeres son mas vulnerables que los hombres',
                
                'Las personas afiliadas al regimen subsidiado son mas vulnerables',
                
                'Entre mas alto el grado de educacion, menos es la probabilidad de ser pobre',
                
                'Los jefes de hogar que se encuentren desempleados hacen que el hogar sea mas vulnerable a estar en condicion de pobreza',
                
                'La actividad que desarrolla un jefe de hogar ayuda a determinar si su hogar puede estar en condicion de pobreza por el diferencial de ingresos en cada actividad',
                
                'Entre mas alto sea el número de personas por hogar mas vulnerable es a estar en condición de pobreza',
                
                'Por la teoria del ciclo vital hay intervalos donde se es mas vulnerable a  estar en la pobreza.',
                
                'Las personas en condición de informalidad son mas vulnerables a estar en pobreza'
  )
)


tabla <- kable(variables,) %>%
  add_header_above(c(" " = 1, "Tabla 1.Variables" = 2), bold = TRUE, align = "c") %>%
  kable_styling(full_width = FALSE)

tabla
```

## Analisis exploratorio de los datos

El analisis exploratorio se datos se divide en dos partes: Analisis univariado y analisis multivariado de datos. En el analisis univariado el proposito es analizar como se distribuyen de forma individual las variables que vamos a utilizar en el proceso de modelacion. Luego con el analisis multivariado nuestro objetivo es ver como se relacionan las variable independientes con el ingreso de los hogares.

### Analisis univariado

```{r}
options(repr.plot.width = 10, repr.plot.height = 5)

ingresos<-train_hogares %>%
  ggplot(aes(x = log(Ingtotugarr))) +
  geom_histogram(binwidth = 1, fill = "blue", color = "black") +
  labs(title = "Distribucion de los ingresos por hogar",
       x = "Ingresos",
       y = "Frecuencia") +
  theme_minimal()


pobreza <- train_hogares %>%
  count(Pobre) %>%
  mutate(
    prop = n / sum(n),
    Pobre = case_when(
      Pobre == 1 ~ "Pobre",
      Pobre == 0 ~ "No pobre"
    )
  ) %>%
  ggplot(aes(x = Pobre, y = prop, fill = Pobre)) +
  geom_bar(stat = "identity") +
  geom_text(aes(label = scales::percent(prop, accuracy = 0.01)), 
            position = position_stack(vjust = 1.05), 
            size = 3) +
  scale_fill_manual(values = c("Pobre" = "#1f78b4", "No pobre" = "#33a02c")) +
  labs(title = "Proporción de pobres por hogar",
       x = "Pobre",
       y = "Proporcion") +
  theme_minimal()
gridExtra::grid.arrange(ingresos, pobreza, ncol = 2)
```

Estas son las dos variables objetivo que se van a explicar en este informe. En la primera gráfica se presentan los ingresos agregados del hogar, que se utilizan para determinar si un hogar es pobre utilizando la línea de pobreza, mientras que la variable 'Pobre' está categorizada como 0 cuando el hogar no es pobre y 1 cuando lo es. Los datos muestran que aproximadamente el 80% de los hogares no están en condición de pobreza, lo que implica un desafío en términos del proceso de modelado debido a que hay un claro desbalance de clases.

### Variables explicativas

```{r}
options(repr.plot.width = 10, repr.plot.height = 5)

grafico_sexo <- train_hogares %>%
  count(sexo_jefe) %>%
  mutate(
    prop = n / sum(n),
    sexo_jefe = case_when(
      sexo_jefe == 1 ~ "Hombre",
      sexo_jefe == 0 ~ "Mujer"
    )
  ) %>%
  ggplot(aes(x = sexo_jefe, y = prop, fill = sexo_jefe)) +
  geom_bar(stat = "identity") +
  geom_text(aes(label = scales::percent(prop, accuracy = 0.01)), 
            position = position_stack(vjust = 1.05), 
            size = 3) +
  scale_fill_manual(values = c("Hombre" = "#1f78b4", "Mujer" = "#33a02c")) +
  labs(title = "Proporción de sexo del jefe de hogar",
       x = "Sexo del jefe de hogar",
       y = "Proporción") +
  theme_minimal()

# Gráfico 2: Proporción del tipo de régimen del jefe de hogar
grafico_regimen <- train_hogares %>%
  filter(regimen_subsidiado_jefe %in% c(1, 0)) %>%
  count(regimen_subsidiado_jefe) %>%
  mutate(
    prop = n / sum(n),
    regimen_subsidiado_jefe = case_when(
      regimen_subsidiado_jefe == 1 ~ "Regimen subsidiado",
      regimen_subsidiado_jefe == 0 ~ "Otro"
    )
  ) %>%
  ggplot(aes(x = regimen_subsidiado_jefe, y = prop, fill = regimen_subsidiado_jefe)) +
  geom_bar(stat = "identity") +
  geom_text(aes(label = scales::percent(prop, accuracy = 0.01)), 
            position = position_stack(vjust = 1.05), 
            size = 3) +
  scale_fill_manual(values = c("Regimen subsidiado" = "#1f78b4", "Otro" = "#33a02c")) +
  labs(title = "Proporción del tipo de régimen del jefe de hogar",
       x = "Tipo de régimen del jefe de hogar",
       y = "Proporción") +
  theme_minimal()

# Presentar ambos gráficos en una grilla
gridExtra::grid.arrange(grafico_sexo, grafico_regimen, ncol = 2)
```

En este caso, observamos que la representación de jefes de hogar masculinos es ligeramente mayor que la de las mujeres que encabezan el hogar. Según la literatura económica, cuando la mujer es la jefa de hogar, existe un mayor riesgo de pobreza en el hogar. Esta situación puede atribuirse a diversos factores, como la brecha salarial de género y la responsabilidad desproporcionada de cuidado y trabajo doméstico no remunerado.

Respecto a los jefes de hogar afiliados al régimen subsidiado, representan aproximadamente el 42% del total. Esta variable es crucial de analizar, ya que el acceso a este mecanismo por parte de los colombianos para obtener servicios cuando no tienen capacidad de pago, sirve como una medida indirecta de la condición de pobreza de un hogar.

```{r}
options(repr.plot.width = 10, repr.plot.height = 5)
grafico_educacion<-train_hogares %>%
  mutate(
    educacion_jefe = case_when(
      educacion_jefe %in% c(0, 6) ~ "Ninguno o no informa",
      educacion_jefe == 1 ~ "Preescolar",
      educacion_jefe == 2 ~ "Básica primaria",
      educacion_jefe == 3 ~ "Básica secundaria",
      educacion_jefe == 4 ~ "Media",
      educacion_jefe == 5 ~ "Superior o universitaria"
    )
  ) %>%
  count(educacion_jefe) %>%
  mutate(
    prop = n / sum(n),
    educacion_jefe = factor(educacion_jefe, levels = c("Ninguno o no informa", "Preescolar", "Básica primaria", "Básica secundaria", "Media", "Superior o universitaria"))
  ) %>%
  ggplot(aes(x = educacion_jefe, y = prop, fill = educacion_jefe)) +
  geom_bar(stat = "identity") +
  geom_text(aes(label = scales::percent(prop, accuracy = 0.01)), 
            position = position_stack(vjust = 1.05), 
            size = 3) +
  scale_fill_discrete(name = "Educación del jefe de hogar") +
  labs(title = "Proporción de nivel educativo del jefe de hogar",
       y = "Proporción") +
  theme_minimal() +
  theme(axis.text.x = element_blank(),
        axis.title.x = element_text('Nivel educativo')) +
  theme(legend.position = "none")


grafico_desempleo<-train_hogares %>%
  count(desempleo_jefe) %>%
  mutate(
    prop = n / sum(n),
    desempleo_jefe = case_when(
      desempleo_jefe == 0 ~ "No desempleado",
      desempleo_jefe == 1 ~ "Desempleado"
    )
  ) %>%
  ggplot(aes(x = desempleo_jefe, y = prop, fill = desempleo_jefe)) +
  geom_bar(stat = "identity") +
  geom_text(aes(label = scales::percent(prop, accuracy = 0.01)), 
            position = position_stack(vjust = 1.05), 
            size = 3) +
  scale_fill_manual(values = c("No desempleado" = "#1f78b4", "Desempleado" = "#33a02c")) +
  labs(title = "Proporción de estado de empleo del jefe de hogar",
       x = "Estado de empleo del jefe de hogar",
       y = "Proporcion") +
  theme_minimal()  +
  theme(legend.position = "none")


gridExtra::grid.arrange(
  grafico_educacion, 
  grafico_desempleo,
  ncol = 2
)
```

Para revisar la educación de los jefes de hogar, primero se filtran aquellos que no saben o no responden, y se calcula la proporción con respecto al total de personas que reportaron su nivel educativo. En este análisis, observamos que la mayoría de los jefes de hogar tienen al menos aprobada la educación básica secundaria. Esta variable es una de las más importantes para predecir el nivel de ingresos de un hogar. Como se mencionó en la introducción de este informe, a medida que el jefe de hogar obtiene un mayor nivel de educación formal, la probabilidad de ser pobre disminuye, ya que una mayor educación se traduce en mayores niveles de ingresos. Sin embargo, es preocupante la gran cantidad de personas que no reportan su último nivel educativo alcanzado.

El estado de empleo es fundamental para determinar si un hogar está en condición de pobreza. Esto se explica porque si el jefe de hogar está desempleado, significa que el hogar no está percibiendo ingresos por parte de la persona encargada del sustento familiar, lo cual aumenta la probabilidad de ser pobre. En este caso, observamos que aproximadamente el 37% de los jefes de hogar no están empleados, una cifra considerable que puede explicar la situación del hogar.

```{r}

options(repr.plot.width = 10, repr.plot.height = 5)
empleo<-train_hogares %>%
  mutate(
    posicion_jefe = case_when(
      posicion_jefe == 1 ~ "Empleado empresa",
      posicion_jefe == 2 ~ "Gobierno",
      posicion_jefe == 3 ~ "Doméstico",
      posicion_jefe == 4 ~ "Por cuenta propia",
      posicion_jefe == 5 ~ "Patrón",
      posicion_jefe == 6 ~ "Trabajador familiar sin remuneración",
      posicion_jefe == 7 ~ "Trabajador sin remuneración",
      posicion_jefe == 8 ~ "Jornalero",
      posicion_jefe == 9 ~ "Otro"
    )
  ) %>%
  filter(!is.na(posicion_jefe)) %>%
  count(posicion_jefe) %>%
  mutate(
    prop = n / sum(n)
  ) %>%
  ggplot(aes(x = posicion_jefe, y = prop, fill = posicion_jefe)) +
  geom_bar(stat = "identity") +
  geom_text(aes(label = scales::percent(prop, accuracy = 0.01)), 
            position = position_stack(vjust = 1.05), 
            size = 3) +
  scale_fill_discrete(name = "Posición del jefe de hogar") +
  labs(title = "Proporción de posición del jefe de hogar",
       x = "Posición del jefe de hogar",
       y = "Proporción") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  theme(legend.position = "none")



casa_propia<-train_hogares %>%
  mutate(tipo_casa = ifelse(tipo_casa == 1, "Casa Propia", "No Casa Propia")) %>%
  count(tipo_casa) %>%
  mutate(prop = n / sum(n)) %>%
  ggplot(aes(x = tipo_casa, y = prop, fill = tipo_casa, label = scales::percent(prop))) +
  geom_bar(stat = "identity") +
  geom_text(position = position_stack(vjust = 1.05), size = 3) +
  scale_fill_manual(values = c("Casa Propia" = "#1f78b4", "No Casa Propia" = "#33a02c")) +
  labs(x = "Tipo de Casa", y = "Proporción", title = "Proporción de Hogares por Tipo de Casa") +
  scale_x_discrete(labels = c("Casa Propia" = "Casa Propia", "No Casa Propia" = "No Casa Propia"))

gridExtra::grid.arrange(
  empleo, 
  casa_propia,
  ncol = 2
)
```

La posición del jefe de hogar en el empleo es importante para determinar si el hogar corre riesgo de estar en situación de pobreza. Se espera que los jefes de hogar que trabajen sin remuneración tengan un mayor riesgo de pobreza. Sin embargo, en nuestro análisis no se observa que esta sea la situación predominante, ya que al combinar estas dos categorías apenas llegan al 1%.

Tener casa propia, en principio, puede ayudar a explicar la situación de pobreza del hogar. Esto se debe a que contar con una vivienda propia permite disponer de una mayor cantidad de ingresos que pueden destinarse a cubrir otras necesidades. La propiedad de una casa se considera una inversión y un seguro en momentos de dificultades económicas. Se supone que las personas que no tienen casa propia podrían ser más vulnerables relativamente a ser pobres. En nuestra muestra, observamos que la mayoría de los jefes de hogar no cuentan con vivienda propia y deben pagar arriendo por su alojamiento. Es fundamental profundizar en esta información para comprender mejor la dinámica de la pobreza en los hogares.

```{r}
options(repr.plot.width = 10, repr.plot.height = 5)

personas<-train_hogares %>%
  filter(Personas_habitacion <= 7) %>%
  ggplot(aes(x = Personas_habitacion)) +
  geom_histogram(binwidth = 1, fill = "blue", color = "black") +
  labs(title = "Distribución de personas por habitación",
       x = "Numero de personas por habitación",
       y = "Frecuencia") +
  theme_minimal()


edad<-train_hogares %>%
  ggplot(aes(x = edad_jefe)) +
  geom_histogram(binwidth = 1, fill = "blue", color = "black") +
  labs(title = "Distribución de la edad de los jefes de hogar",
       x = "Edad jefes de hogar",
       y = "Frecuencia") +
  theme_minimal()

gridExtra::grid.arrange(
  personas, 
  edad,
  ncol = 2
)
```

El número de personas por habitación también se considera importante para predecir la pobreza, ya que se espera que a mayor número de personas por habitación, exista un hacinamiento que aumente el riesgo de pobreza. En nuestro análisis, la mayoría de los datos se concentran en 2 personas por habitación, lo cual es una situación normal.

Es fundamental incorporar la edad del jefe del hogar en nuestro análisis, ya que está intrínsecamente ligada a la teoría del ciclo de vida en economía, la cual postula que las personas atraviesan diferentes etapas en su vida, cada una con características económicas específicas que pueden influir en su vulnerabilidad a la pobreza.

En el contexto colombiano, esta teoría cobra especial relevancia, ya que tanto los jóvenes como los ancianos son considerados grupos de población vulnerables. Por un lado, los jóvenes tienden a enfrentar mayores dificultades económicas debido a su entrada reciente al mercado laboral y su menor experiencia, lo que puede traducirse en ingresos más bajos y una mayor vulnerabilidad financiera. Este fenómeno se ve exacerbado por las altas tasas de desempleo que suelen afectar a este grupo demográfico. Por lo tanto, es plausible suponer que los jefes de hogar más jóvenes enfrenten desafíos adicionales para alcanzar la estabilidad financiera, lo que podría aumentar su probabilidad de experimentar situaciones de pobreza.

Por otro lado, la teoría del ciclo de vida también reconoce que los ancianos, especialmente después de su retiro, pueden enfrentar dificultades económicas debido a ingresos fijos y limitados, como pensiones o jubilaciones, que pueden no ser suficientes para cubrir todas sus necesidades. A pesar de haber contribuido al mercado laboral durante años, las limitaciones en los ingresos de jubilación pueden dejar a los ancianos en una situación económica precaria, lo que aumenta la probabilidad de que los hogares encabezados por personas mayores estén en situación de pobreza.

Si bien en nuestra muestra de datos observamos una distribución uniforme de las edades de los jefes de hogar, la teoría del ciclo de vida nos permite anticipar que los hogares liderados por personas más jóvenes y más mayores podrían enfrentar mayores dificultades económicas, cada uno por razones asociadas a su etapa de vida.

```{r}
options(repr.plot.width = 10, repr.plot.height = 5)


zona<-train_hogares %>%
  mutate(
    zona_jefe = case_when(
      zona_jefe == 1 ~ "Rural",
      zona_jefe == 2 ~ "Resto urbano",
      zona_jefe == 3 ~ "Ciudad"
    )
  ) %>%
  count(zona_jefe) %>%
  mutate(prop = n / sum(n)) %>%
  ggplot(aes(x = zona_jefe, y = prop, fill = zona_jefe, label = scales::percent(prop))) +
  geom_bar(stat = "identity") +
  geom_text(position = position_stack(vjust = 1.05), size = 3) +
  scale_fill_manual(values = c("Rural" = "#1f78b4", "Resto urbano" = "#33a02c", "Ciudad" = "#e31a1c")) +
  labs(x = "Zona", y = "Proporción", title = "Proporción de zona") +
  scale_x_discrete(labels = c("Rural" = "Rural", "Resto urbano" = "Resto urbano", "Ciudad" = "Ciudad"))

informal<-train_hogares %>%
  mutate(informalidad_jefe = ifelse(informalidad_jefe == 1, "Informal", "Formal")) %>%
  count(informalidad_jefe) %>%
  mutate(prop = n / sum(n)) %>%
  ggplot(aes(x = informalidad_jefe, y = prop, fill = informalidad_jefe, label = scales::percent(prop))) +
  geom_bar(stat = "identity") +
  geom_text(position = position_stack(vjust = 1.05), size = 3) +
  scale_fill_manual(values = c("Formal" = "#1f78b4", "Informal" = "#33a02c")) +
  labs(x = "Tipo de trabajo", y = "Proporción", title = "Proporción tipo de trabajo") +
  scale_x_discrete(labels = c("Informal" = "Informal", "Formal" = "Formal"))



gridExtra::grid.arrange(  informal, 
  zona,
  ncol = 2
)
```

La distinción entre el tipo de empleo a través de la informalidad laboral es un factor crucial para determinar las condiciones de pobreza de un hogar. El trabajo informal se caracteriza por salarios bajos y condiciones laborales precarias, lo que puede aumentar significativamente el riesgo de pobreza para quienes se desempeñan en este sector. En nuestros datos, observamos que aproximadamente el 47% de las personas trabajan en condiciones de informalidad, una cifra que concuerda con los datos nacionales y subraya la magnitud del desafío que representa la informalidad laboral en términos de pobreza.

Además, la ubicación geográfica del hogar también desempeña un papel crucial, ya que las viviendas ubicadas en áreas más alejadas del centro económico suelen considerarse más vulnerables. Esta disparidad se explica en parte por la teoría del centro-periferia, que destaca las diferencias en el desarrollo económico entre las áreas urbanas centrales y las regiones periféricas. En el contexto urbano, el centro se caracteriza por un mayor desarrollo económico e industrial, mientras que las áreas rurales tienden a tener un menor desarrollo, con actividades económicas centradas en la agricultura y la extracción de recursos, que generalmente se asocian con salarios más bajos. Aunque en nuestra muestra hay una representación limitada del área rural, este análisis nos brinda una aproximación útil para evaluar la probabilidad de pobreza en función de la ubicación del hogar y su relación con la teoría del centro-periferia.

```{r}

cualitativas <- c("sexo_jefe", "regimen_subsidiado_jefe", "educacion_jefe", "desempleo_jefe", "posicion_jefe","Personas_habitacion_r","tipo_casa","edad_jefe_joven","zona_jefe","informalidad_jefe")


train_hogares[cualitativas] <- lapply(train_hogares[cualitativas], factor)

plots_list <- list()


for (variable in cualitativas) {
  plot <- ggplot(train_hogares, aes_string(x = variable, y = "log(Ingtotugarr)", fill = variable)) +
    geom_boxplot(show.legend = FALSE) +
    labs(x = variable, y = "log(Ingtotugarr)") +
    theme_minimal()
  
  plots_list[[variable]] <- plot
}


gridExtra::grid.arrange(grobs = plots_list, ncol =3)
```

En la gráfica anterior, se observan las variables seleccionadas en relación con el logaritmo de los ingresos del hogar. Este enfoque se utiliza para normalizar los datos y facilitar la comparación entre las variables de interés. En términos generales, se puede apreciar que las personas afiliadas al régimen subsidiado tienen ingresos ligeramente inferiores en comparación con aquellos que son cotizantes. Del mismo modo, se evidencia que las personas desempleadas tienden a tener ingresos menores en el hogar. En cuanto al sexo del jefe de hogar, las diferencias en los ingresos no son tan marcadas. Sin embargo, se observan diferencias significativas en los ingresos agregados según el nivel educativo del jefe de hogar y su posición laboral.

Además, se aprecia que a medida que aumenta el número de personas por habitación, la media de ingresos del hogar tiende a disminuir, lo cual coincide con lo reportado en la literatura. Respecto a las variables tipo_casa y edad_jefe_joven, los resultados son coherentes con lo esperado, ya que los jefes de hogar que poseen vivienda propia y son adultos suelen tener mayores ingresos, lo que reduce la probabilidad de estar en situación de pobreza.

El tema de la informalidad laboral también muestra diferencias significativas en los ingresos de las personas. En general, aquellos que trabajan en condiciones de informalidad tienen ingresos más bajos, lo que aumenta su vulnerabilidad económica y, por ende, la probabilidad de estar en situación de pobreza.

```{r}
generar_grafico <- function(data, variable) {
  grafico <- data %>%
    group_by(!!variable, Pobre) %>%
    summarise(count = n()) %>%
    mutate(prop = count / sum(count)) %>%
    ggplot(aes(x = !!variable, y = prop, fill = Pobre)) +
    geom_bar(position = "fill", stat = "identity") +
    labs(x = as_label(ensym(variable)), y = "Proporción", fill = "Pobre") +
    theme_minimal()
  
  return(grafico)
}

cualitativas <- c("sexo_jefe", "regimen_subsidiado_jefe", "educacion_jefe", "desempleo_jefe", "posicion_jefe","Personas_habitacion_r","tipo_casa","edad_jefe_joven","zona_jefe","informalidad_jefe")

plots_list <- list()

for (variable in cualitativas) {
  plots_list[[variable]] <- generar_grafico(train_hogares, sym(variable))
}

# Mostrar los gráficos en una grilla
gridExtra::grid.arrange(grobs = plots_list, ncol = 4)
```

Cuando se analiza en relación con la variable de pobreza, se observa un patrón muy similar al analizar los ingresos del hogar. Sin embargo, se destaca que la tenencia de vivienda propia marca una diferencia más significativa que cuando se analiza únicamente por medio de los ingresos. Esto sugiere que la posesión de vivienda propia puede ser un factor más determinante en la reducción de la probabilidad de pobreza, independientemente de los niveles de ingresos del hogar.

# Estimacion de los modelos

# Conclusiones
