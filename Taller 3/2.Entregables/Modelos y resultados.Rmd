---
title: "Modelos y resultados"
author: "William Aguirre & John Esteban Londoño"
date: "2024-05-26"
output:
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(kableExtra)
```

# Modelos y resultados

Para entrenar los modelos se utilizó la técnica de validación cruzada, de manera que se pudiera reducir el efecto de la autocorrelación espacial sobre el aprendizaje de cada modelo. Teniendo en cuenta que el Marco Geoestadístico Nacional del DANE provee una agrupación geográfica a nivel de manzana, sección (conjuntos de manzanas) y sectores (conjuntos de secciones), se pudo utilizar cada sección como un fold que rompiera con la dependencia espacial del precio.

```{r, eval=FALSE}
sectores<-unique(train$cod_sector)
folds<-createFolds(sectores,k=length(sectores),list = TRUE,returnTrain = TRUE)
```

Los modelos se entrenaron en primera instancia con la información extraida de la base de datos y del censo del DANE `nbanios`, `nhabitaciones`, `piso_apartamento` ; `estrato` . Dado que los precios de las viviendas también corresponden a diferentes meses de un horizonte de tiempo de tres años, se tuvo que incluir la variable `periodo` para tratar de establecer un efecto fijo del tiempo sobre el precio. Posteriormente se fueron incluyendo las variables de seguridad y salud, encontrando que hubo una mejora significativa en la predicción al incluir este tipo de variables.

```{r, include=FALSE}
summary_resultados<-read.csv("https://raw.githubusercontent.com/Esteban7777/Curso-Big-Data/main/Taller%203/1.Procesamiento%20y%20Sintaxis/Resumen%20de%20resultados%20outsample.csv",sep = ";")
summary_resultados<-summary_resultados %>% 
  rename(
    'Variable objetivo'=X.Variable.objetivo.,
    'Predictores utilizados'=X.Predictores.utilizados.,
    'MAE fuera de muestra'=X.MAE.fuera.de.muestra.)

print(summary_resultados)
```

Los algoritmos utilizados para las predicciones fueron *Regresión lineal*[[\*]](https://github.com/Esteban7777/Curso-Big-Data/blob/main/Taller%203/1.Procesamiento%20y%20Sintaxis/Sintaxis%20modelos/Regresion%20Lineal.R "Sintáxis de regresión lineal"), *Elastic net* [[\*\*]](https://github.com/Esteban7777/Curso-Big-Data/blob/main/Taller%203/1.Procesamiento%20y%20Sintaxis/Sintaxis%20modelos/Elastic%20net.R "Sintáxis de Elastic Net")*, Random forest* [[\*\*\*]](https://github.com/Esteban7777/Curso-Big-Data/blob/main/Taller%203/1.Procesamiento%20y%20Sintaxis/Sintaxis%20modelos/Random%20Forest.R "Sintáxis de Random Forest")y *Xgboost* [[\*\*\*\*]](https://github.com/Esteban7777/Curso-Big-Data/blob/main/Taller%203/1.Procesamiento%20y%20Sintaxis/Sintaxis%20modelos/Xgboost.R "Sintáxis de Xgboost")*.* Cada uno de estos se entrenó realizando la validación cruzada con los folds anteriormente señalados que pueden ser observados en [Mapa de folds](https://github.com/Esteban7777/Curso-Big-Data/blob/main/Taller%203/1.Procesamiento%20y%20Sintaxis/Imagenes/Viviendas%20en%20Train%20por%20Sector.png).

```{r, echo=FALSE}
summary_resultados %>%
  kable("latex", caption = "Resumen de resultados") %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = T,font_size = 8)
```

# Conclusiones y recomendaciones

Se logra evidenciar que las caracteristicas de una vivienda son un buen predictor de su precio, sin embargo, las variables del entorno también se convierten en un factor importante al momento de establecer su precio. Evidenciamos como hay aspectos del entorno que pueden afectar positivamente su precio, como la distancia a amenities como hospítales, mientras que existen otras variables que pueden impactar negativamente el precio, como el aumento de la criminalidad en la zona.

También observamos que en este tipo de problemas algoritmos que tienen un poca carga computacional como Elastic Net y la propia regresión lineal tienen un rendimiento aceptable frente a algunos modelos más complejos como Xgboost. Por lo que el tiempo dedicado a entrenar modelos podría bien utilizarse en mejorar la modelación en una regresión y obtener resultados mucho mejores y menos costosos.

La cantidad de variables del entorno incluidas impacta significativamente el rendimiento de los modelos, por lo que se recomienda en estos problemas dedicar un mayor tiempo a la construcción de un set de datos lo más completo posible. En este sentido, por restricciones de tiempo no fue posible incluir otras variables que podrían mejorar la predicción como la distancia a centros comerciales y zonas verdes.

\
